<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Our Story - Skeleton Test</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: sans-serif; }
        
        /* --- SCENE 1: THE "ROOM" SKELETON --- */
        #room-container {
            position: absolute;
            top: 0; left: 0; width: 100vw; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            z-index: 5;
            /* Zooms toward the bottom left where our fake TV is */
            transform-origin: 25% 75%; 
        }

        #room-scene {
            position: relative;
            width: 100vw;
            max-width: 177.77vh; /* 16:9 ratio */
            aspect-ratio: 16/9;
            /* Fake cartoon wall and floor using a gradient */
            background: linear-gradient(to bottom, #ff99cc 0%, #ff99cc 65%, #20b2aa 65%, #20b2aa 100%);
            border: 5px solid #333; 
        }

        /* The glowing box that acts as our video placeholder */
        #tv-placeholder {
            position: absolute;
            bottom: 15%; 
            left: 10%;
            width: 30%;
            height: 40%;
            background-color: #00f2fe; 
            border: 8px solid #222;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 242, 254, 0.8);
            display: flex; justify-content: center; align-items: center;
            color: #111; font-weight: bold; font-size: 2vw; text-align: center;
        }

        /* --- UI ELEMENTS --- */
        #startBtn {
            position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 20px 40px; font-size: 24px;
            background-color: #ff4d4d; color: white;
            border: none; border-radius: 30px;
            cursor: pointer; z-index: 10;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        /* --- SCENE 2: THREE.JS CANVAS --- */
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; opacity: 0; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body>

    <button id="startBtn">Click to Test Animation</button>

    <div id="room-container">
        <div id="room-scene">
            <div id="tv-placeholder">VIDEO PLAYS HERE<br>(Flickering)</div>
        </div>
    </div>

    <script>
        // --- 1. SET UP THE 3D BOOK ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a1a);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const light = new THREE.AmbientLight(0xffffff, 1.2);
        scene.add(light);

        const bookGroup = new THREE.Group();
        scene.add(bookGroup);

        const pageGeo = new THREE.PlaneGeometry(3, 4);
        
        // Left Page (Solid pink placeholder instead of your photo)
        const leftPage = new THREE.Mesh(pageGeo, new THREE.MeshBasicMaterial({ color: 0xffb3b3, side: THREE.DoubleSide }));
        leftPage.position.set(-1.5, 0, 0);
        leftPage.rotation.y = Math.PI / 8;
        bookGroup.add(leftPage);

        // Right Page (The Map Base)
        const rightPage = new THREE.Mesh(pageGeo, new THREE.MeshBasicMaterial({ color: 0xeaf6ff, side: THREE.DoubleSide }));
        rightPage.position.set(1.5, 0, 0);
        rightPage.rotation.y = -Math.PI / 8;
        bookGroup.add(rightPage);

        // The Route 
        const curve = new THREE.CatmullRomCurve3([
            new THREE.Vector3(0.5, -1.5, 0.2), new THREE.Vector3(1.5, 0, 0.5), new THREE.Vector3(2.5, 1.5, 0.2)
        ]);
        const routeLine = new THREE.Line(
            new THREE.BufferGeometry().setFromPoints(curve.getPoints(50)), 
            new THREE.LineBasicMaterial({ color: 0xff0000, linewidth: 4 })
        );
        bookGroup.add(routeLine);

        // The 3D Car
        const car = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.2, 0.2), new THREE.MeshBasicMaterial({ color: 0x222222 }));
        bookGroup.add(car);

        camera.position.set(0, 0, 6);

        // --- 2. THE MAGICAL TRANSITION LOGIC ---
        let isBookScene = false;
        let fraction = 0;
        let isTvPlaying = false;
        const tvBox = document.getElementById('tv-placeholder');

        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('startBtn').style.display = 'none';
            isTvPlaying = true;

            // Wait 3 seconds, then trigger the zoom!
            setTimeout(() => {
                triggerZoomTransition();
            }, 3000); 
        });

        function triggerZoomTransition() {
            isTvPlaying = false;
            // Smoothly scale the entire room container so the TV fills the screen
            gsap.to("#room-container", {
                scale: 6, // Zooms way in
                opacity: 0, // Fades the room out
                duration: 2.5,
                ease: "power2.inOut",
                onComplete: () => {
                    document.getElementById('room-container').style.display = 'none';
                    
                    // Fade in the 3D Book canvas
                    gsap.to("canvas", { opacity: 1, duration: 1 });
                    isBookScene = true;
                }
            });
        }

        // --- 3. ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);

            // Make the fake TV flicker to simulate a video playing
            if (isTvPlaying) {
                const flicker = 0.8 + Math.random() * 0.2;
                tvBox.style.opacity = flicker;
            }

            if (isBookScene) {
                // Gentle floating book effect
                bookGroup.rotation.y = Math.sin(Date.now() * 0.0005) * 0.05;
                bookGroup.rotation.x = Math.sin(Date.now() * 0.0005) * 0.05;
                
                // Drive the car
                fraction += 0.005;
                if (fraction > 1) fraction = 0;
                car.position.copy(curve.getPoint(fraction));
            }

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
