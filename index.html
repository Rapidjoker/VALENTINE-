<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jess & Renee - Our Journey</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', Tahoma, sans-serif; }
        
        /* Loading Screen */
        #loading {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: white; display: flex; 
            justify-content: center; align-items: center; z-index: 100;
        }

        /* UI Buttons */
        button {
            position: absolute; z-index: 10; padding: 15px 35px;
            font-size: 18px; font-weight: bold; background-color: #ff4d4d;
            color: white; border: none; border-radius: 50px; cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 77, 77, 0.6); 
            transition: all 0.3s ease;
            text-transform: uppercase; letter-spacing: 1px;
        }
        button:hover { background-color: #ff1a1a; transform: scale(1.1); box-shadow: 0 0 40px rgba(255, 77, 77, 0.9); }
        
        #startBtn { top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; }
        #nextBtn { bottom: 50px; right: 50px; display: none; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body>

    <div id="loading">Loading our world...</div>

    <video id="tvVideo" src="1001189975.mp4" playsinline style="display:none;" loop crossorigin="anonymous"></video>
    <video id="parkVideo" src="1001189978.mp4" playsinline style="display:none;" loop crossorigin="anonymous"></video>

    <button id="startBtn">Enter Room</button>
    <button id="nextBtn">Next Chapter âž”</button>

    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 1.1);
        scene.add(ambientLight);

        const textureLoader = new THREE.TextureLoader();
        const manager = new THREE.LoadingManager();

        // --- SCENE 1: THE SIMPSONS 3D ROOM ---
        const roomGroup = new THREE.Group();
        scene.add(roomGroup);

        // 1. The Wall (Your Simpsons Image)
        textureLoader.load('1001230172.jpg', (tex) => {
            const aspect = 16 / 9; 
            const geometry = new THREE.PlaneGeometry(20, 20 / aspect);
            const material = new THREE.MeshBasicMaterial({ map: tex });
            const wall = new THREE.Mesh(geometry, material);
            wall.position.z = -5;
            roomGroup.add(wall);
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('startBtn').style.display = 'block';
        });

        // 2. The TV Screen (Your Real Video)
        const video1 = document.getElementById('tvVideo');
        const videoTex1 = new THREE.VideoTexture(video1);
        const tvGeometry = new THREE.PlaneGeometry(4.5, 3.2); 
        const tvMaterial = new THREE.MeshBasicMaterial({ map: videoTex1 });
        const tvScreen = new THREE.Mesh(tvGeometry, tvMaterial);
        
        tvScreen.position.set(-3.8, -2.5, -4.9); 
        tvScreen.rotation.z = 0.02; 
        roomGroup.add(tvScreen);

        // --- SCENE 2: THE 3D BOOK ---
        const bookGroup = new THREE.Group();
        bookGroup.visible = false;
        scene.add(bookGroup);

        const pageGeo = new THREE.PlaneGeometry(3.5, 5);

        // Left Page
        const photoTex = textureLoader.load('1001191122.jpg');
        const leftPageMat = new THREE.MeshBasicMaterial({ map: photoTex, side: THREE.DoubleSide });
        const leftPage = new THREE.Mesh(pageGeo, leftPageMat);
        leftPage.position.set(-1.75, 0, 0);
        leftPage.rotation.y = Math.PI / 8; 
        bookGroup.add(leftPage);

        // Right Page
        const rightPage = new THREE.Mesh(pageGeo, new THREE.MeshBasicMaterial({ color: 0xe6f3ff, side: THREE.DoubleSide }));
        rightPage.position.set(1.75, 0, 0);
        rightPage.rotation.y = -Math.PI / 8;
        bookGroup.add(rightPage);

        // Add Map Decorations
        const mapTexture = new THREE.CanvasTexture(createMapCanvas());
        rightPage.material.map = mapTexture;
        rightPage.material.needsUpdate = true;

        // --- THE CAR & ROUTE ---
        const route1 = new THREE.CatmullRomCurve3([
            new THREE.Vector3(0.5, -1.5, 0.2),
            new THREE.Vector3(1.5, 0, 0.5),
            new THREE.Vector3(2.5, 1.5, 0.2)
        ]);

        const route2 = new THREE.CatmullRomCurve3([
            new THREE.Vector3(2.5, 1.5, 0.2),
            new THREE.Vector3(1.0, 1.0, 0.6),
            new THREE.Vector3(0.5, -1.0, 0.2)
        ]);

        let currentRoute = route1;
        
        const lineGeo = new THREE.BufferGeometry().setFromPoints(currentRoute.getPoints(50));
        const lineMat = new THREE.LineBasicMaterial({ color: 0xff0000, linewidth: 3 });
        const routeLine = new THREE.Line(lineGeo, lineMat);
        bookGroup.add(routeLine);

        const car = new THREE.Mesh(
            new THREE.BoxGeometry(0.4, 0.2, 0.2), 
            new THREE.MeshBasicMaterial({ color: 0x3366ff })
        );
        bookGroup.add(car);

        camera.position.z = 5;

        // --- INTERACTION LOGIC ---
        
        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('startBtn').style.display = 'none';
            video1.play(); 

            setTimeout(() => {
                gsap.to(camera.position, {
                    x: -3.8, 
                    y: -2.5, 
                    z: -4.0, 
                    duration: 2.5,
                    ease: "power2.inOut",
                    onComplete: () => {
                        roomGroup.visible = false;
                        bookGroup.visible = true;
                        
                        camera.position.set(0, 0, 7);
                        camera.rotation.set(0, 0, 0);
                        
                        document.getElementById('nextBtn').style.display = 'block';
                    }
                });
            }, 4000);
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            document.getElementById('nextBtn').style.display = 'none';
            
            const video2 = document.getElementById('parkVideo');
            const videoTex2 = new THREE.VideoTexture(video2);
            leftPage.material.map = videoTex2;
            leftPage.material.needsUpdate = true;
            video2.play();

            currentRoute = route2;
            routeLine.geometry.setFromPoints(currentRoute.getPoints(50));
            fraction = 0; 
        });

        // --- ANIMATION LOOP ---
        let fraction = 0;
        function animate() {
            requestAnimationFrame(animate);

            if (bookGroup.visible) {
                bookGroup.rotation.y = Math.sin(Date.now() * 0.001) * 0.05;

                fraction += 0.004;
                if (fraction > 1) fraction = 0;
                
                const point = currentRoute.getPoint(fraction);
                car.position.copy(point);
                car.lookAt(currentRoute.getPoint(Math.min(fraction + 0.01, 1)));
            }

            renderer.render(scene, camera);
        }
        animate();

        function createMapCanvas() {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 700;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#eaf6ff';
            ctx.fillRect(0,0,512,700);
            ctx.fillStyle = '#333';
            ctx.font = 'bold 40px Arial';
            ctx.fillText("Gaborone Map", 120, 100);
            ctx.font = '30px Arial';
            ctx.fillText("10996 Rametsane", 50, 600);
            ctx.fillText("59866 Shorobe St", 200, 100);
            return canvas;
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
