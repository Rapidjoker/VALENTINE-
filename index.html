<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Valentine's Journey ¬∑ Gaborone</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Georgia', serif; background-color: #0a0a1a; }
        
        #instruction {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            background: #fff0f5; color: #b3002d; padding: 16px 48px;
            border-radius: 60px; font-size: 1.5rem; font-weight: bold;
            letter-spacing: 2px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 3px solid gold; z-index: 30; cursor: pointer; transition: 0.3s;
        }
        #instruction:hover { background: white; transform: translateX(-50%) scale(1.05); border-color: #ff4d6d; }
        
        #page-hint {
            position: absolute; bottom: 20px; right: 30px; background: rgba(0,0,0,0.7);
            color: gold; padding: 10px 20px; border-radius: 40px; font-size: 1rem;
            z-index: 30; pointer-events: none; backdrop-filter: blur(5px); border: 1px solid #ffb3c6;
            display: none; /* Hidden until the book appears */
        }
        
        .note {
            position: absolute; top: 20px; right: 30px; color: rgba(255,255,255,0.9);
            font-size: 0.9rem; text-shadow: 1px 1px 3px black; z-index: 30;
        }
    </style>
</head>
<body>
    
    <video id="tvVideo" src="1001189975.mp4" playsinline style="display:none;" loop crossorigin="anonymous"></video>

    <div id="instruction">‚ù§Ô∏è Begin Our Valentine's Story ‚ù§Ô∏è</div>
    <div id="page-hint" id="hint">üìñ Click the book to turn pages</div>
    <div class="note">10996 Rametsane ‚Üí 59866 Shorobe St, Block 7 ¬∑ Gaborone</div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        // --- Core Setup ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a1a); 

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(-1.5, 1.8, 4.5); 

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        const labelRenderer = new CSS2DRenderer();
        labelRenderer.setSize(window.innerWidth, window.innerHeight);
        labelRenderer.domElement.style.position = 'absolute';
        labelRenderer.domElement.style.top = '0px';
        labelRenderer.domElement.style.pointerEvents = 'none';
        document.body.appendChild(labelRenderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.enabled = false; 

        // --- Lighting ---
        scene.add(new THREE.AmbientLight(0x40406b, 1.5));
        const mainLight = new THREE.DirectionalLight(0xffeedd, 1.5);
        mainLight.position.set(2, 5, 4);
        mainLight.castShadow = true;
        scene.add(mainLight);

        // --- TEXTURES (Load your real photo!) ---
        const textureLoader = new THREE.TextureLoader();
        const realPhotoTex = textureLoader.load('1001191122.jpg');

        // --- SCENE 1: SITTING ROOM ---
        const roomGroup = new THREE.Group();
        
        // Couch & Room Basics
        const floorMat = new THREE.MeshStandardMaterial({ color: 0x4a3c31 });
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(8, 6), floorMat);
        floor.rotation.x = -Math.PI / 2;
        roomGroup.add(floor);

        const wallMat = new THREE.MeshStandardMaterial({ color: 0x8a7a6a });
        const backWall = new THREE.Mesh(new THREE.BoxGeometry(8, 4, 0.3), wallMat);
        backWall.position.set(0, 2, -2.85);
        roomGroup.add(backWall);

        // Simple Couch
        const couchMat = new THREE.MeshStandardMaterial({ color: 0x6a4e3a });
        const couchBase = new THREE.Mesh(new THREE.BoxGeometry(2.5, 0.5, 1.2), couchMat);
        couchBase.position.set(-1.2, 0.25, 1.5);
        roomGroup.add(couchBase);

        // TV & Real Video Screen
        const tvCabinet = new THREE.Mesh(new THREE.BoxGeometry(2.5, 0.8, 0.8), new THREE.MeshStandardMaterial({ color: 0x3a2a1a }));
        tvCabinet.position.set(0, 0.4, -2.2);
        roomGroup.add(tvCabinet);

        const videoEl = document.getElementById('tvVideo');
        const videoTex = new THREE.VideoTexture(videoEl);
        const screenMat = new THREE.MeshStandardMaterial({ map: videoTex, emissive: 0x111111 });
        const screen = new THREE.Mesh(new THREE.PlaneGeometry(2.0, 1.2), screenMat);
        screen.position.set(0, 1.4, -1.8);
        roomGroup.add(screen);

        scene.add(roomGroup);

        // --- SCENE 2: MAP ---
        const mapGroup = new THREE.Group();
        mapGroup.visible = false;

        const mapPlane = new THREE.Mesh(new THREE.PlaneGeometry(20, 20), new THREE.MeshStandardMaterial({ color: 0xc0b0a0 }));
        mapPlane.rotation.x = -Math.PI / 2;
        mapGroup.add(mapPlane);
        mapGroup.add(new THREE.GridHelper(20, 40, 0x8b5a2b, 0x5a3a1a));

        const startPos = new THREE.Vector3(-6, 0.1, -4);
        const endPos = new THREE.Vector3(7, 0.1, 5);
        
        mapGroup.add(new THREE.Mesh(new THREE.SphereGeometry(0.3), new THREE.MeshStandardMaterial({ color: 0xffaa00 }))).position.copy(startPos);
        mapGroup.add(new THREE.Mesh(new THREE.SphereGeometry(0.3), new THREE.MeshStandardMaterial({ color: 0xff4d6d }))).position.copy(endPos);

        const car = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.2, 0.3), new THREE.MeshStandardMaterial({ color: 0xff3333 }));
        mapGroup.add(car);

        const curve = new THREE.CatmullRomCurve3([startPos, new THREE.Vector3(-3, 0.1, -1), new THREE.Vector3(0, 0.1, 1), new THREE.Vector3(3, 0.1, 3), endPos]);
        const pathLine = new THREE.Line(new THREE.BufferGeometry().setFromPoints(curve.getPoints(100)), new THREE.LineDashedMaterial({ color: 0xffaa00, dashSize: 0.2, gapSize: 0.1 }));
        mapGroup.add(pathLine);

        scene.add(mapGroup);

        // --- SCENE 3: THE BOOK ---
        const bookGroup = new THREE.Group();
        bookGroup.visible = false;

        const pages = [];
        for (let i = 0; i < 5; i++) {
            let mat;
            // Page 1 is your real photo
            if (i === 0) {
                mat = new THREE.MeshStandardMaterial({ map: realPhotoTex });
            } else {
                // Other pages are romantic placeholders
                const c = document.createElement('canvas'); c.width = 512; c.height = 512; const ctx = c.getContext('2d');
                ctx.fillStyle = '#fff9f0'; ctx.fillRect(0, 0, 512, 512);
                ctx.font = 'italic 40px "Georgia"'; ctx.fillStyle = '#b3002d'; ctx.textAlign = 'center';
                ctx.fillText(`Our Memory #${i+1}`, 256, 256);
                mat = new THREE.MeshStandardMaterial({ map: new THREE.CanvasTexture(c) });
            }
            
            const pageMesh = new THREE.Mesh(new THREE.BoxGeometry(2.0, 0.02, 2.8), mat);
            pageMesh.position.set(0, 0.1 + i * 0.05, 0);
            bookGroup.add(pageMesh);
            pages.push(pageMesh);
        }

        bookGroup.position.set(0, 1.2, 2);
        scene.add(bookGroup);

        // --- ANIMATION LOGIC ---
        let state = 'intro'; 
        let zoomStartTime = 0;
        let carProgress = 0;
        let currentPage = 0;

        document.getElementById('instruction').addEventListener('click', () => {
            if (state === 'intro') {
                document.getElementById('instruction').style.display = 'none';
                videoEl.play(); // Start your real video!
                state = 'tvPlaying';
                
                // Watch video for 4 seconds, then zoom
                setTimeout(() => {
                    state = 'zooming';
                    zoomStartTime = performance.now() / 1000;
                }, 4000);
            }
        });

        // Click to turn pages
        window.addEventListener('click', () => {
            if (state === 'book') {
                currentPage = (currentPage + 1) % pages.length;
                pages.forEach((p, idx) => {
                    p.position.y = 0.1 + idx * 0.05 + (idx === currentPage ? 0.2 : 0);
                    p.rotation.z = (idx === currentPage ? 0.05 : 0);
                });
            }
        });

        const clock = new THREE.Clock();

        function animate() {
            const elapsed = performance.now() / 1000;

            if (state === 'zooming') {
                const zProgress = Math.min((elapsed - zoomStartTime) / 2.0, 1);
                
                camera.position.lerpVectors(new THREE.Vector3(-1.5, 1.8, 4.5), new THREE.Vector3(0, 1.4, -1.0), zProgress);
                
                if (zProgress >= 1) {
                    roomGroup.visible = false;
                    mapGroup.visible = true;
                    camera.position.set(0, 8, 12);
                    controls.target.set(0, 0, 0);
                    state = 'map';
                }
            }

            if (state === 'map') {
                carProgress += 0.003;
                if (carProgress >= 1) {
                    carProgress = 1;
                    if (!bookGroup.visible) {
                        bookGroup.visible = true;
                        document.getElementById('page-hint').style.display = 'block';
                        state = 'book';
                        camera.position.set(0, 4, 6);
                        controls.target.set(0, 1.2, 2);
                    }
                }
                const point = curve.getPoint(carProgress);
                car.position.copy(point);
                const tangent = curve.getTangent(carProgress);
                car.rotation.y = Math.atan2(tangent.x, tangent.z);
            }

            if (state === 'book') {
                bookGroup.rotation.y = Math.sin(elapsed) * 0.05;
            }

            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
            requestAnimationFrame(animate);
        }

        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
