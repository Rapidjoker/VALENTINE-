<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>For Jess - Our Journey</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', Tahoma, sans-serif; }
        canvas { display: block; }
        
        button {
            position: absolute; z-index: 10; padding: 15px 30px;
            font-size: 20px; font-weight: bold; background-color: #ff4d4d;
            color: white; border: none; border-radius: 30px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 77, 77, 0.4); transition: 0.3s;
        }
        button:hover { background-color: #ff1a1a; }
        
        #startBtn { top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px 40px; font-size: 24px; }
        #nextBtn { bottom: 40px; right: 40px; display: none; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body>

    <video id="tvVideo" src="1001189975.mp4" playsinline style="display:none;" loop></video>
    <video id="parkVideo2" src="1001189978.mp4" playsinline style="display:none;" loop></video>

    <button id="startBtn">Enter the Room</button>
    <button id="nextBtn">Next Chapter âž”</button>

    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const light = new THREE.AmbientLight(0xffffff, 1.2);
        scene.add(light);

        const textureLoader = new THREE.TextureLoader();

        // --- SCENE 1: SIMPSONS ROOM IN 3D SPACE ---
        const roomGroup = new THREE.Group();
        scene.add(roomGroup);

        // Load the Simpsons image onto a 3D wall
        const roomTexture = textureLoader.load('1001230172.jpg');
        const roomWall = new THREE.Mesh(
            new THREE.PlaneGeometry(16, 9), 
            new THREE.MeshBasicMaterial({ map: roomTexture })
        );
        roomWall.position.set(0, 0, -5);
        roomGroup.add(roomWall);

        // The 3D Video Screen mapped perfectly over the drawing's TV
        const videoEl = document.getElementById('tvVideo');
        const videoTex = new THREE.VideoTexture(videoEl);
        const tvScreen = new THREE.Mesh(
            new THREE.PlaneGeometry(3.6, 2.6), 
            new THREE.MeshBasicMaterial({ map: videoTex })
        );
        
        // These coordinates place the video directly over the TV in the bottom left
        tvScreen.position.set(-3.5, -2.1, -4.9); 
        tvScreen.rotation.z = -0.05; // Slight tilt to match the artwork
        roomGroup.add(tvScreen);

        camera.position.set(0, 0, 4);

        // --- SCENE 2: 3D BOOK WITH REAL PHOTO ---
        const bookGroup = new THREE.Group();
        bookGroup.visible = false;
        scene.add(bookGroup);

        const pageGeo = new THREE.PlaneGeometry(3, 4);
        
        // Left Page gets the real photo of you two
        const photoTex = textureLoader.load('1001191122.jpg');
        const leftPageMat = new THREE.MeshBasicMaterial({ map: photoTex, side: THREE.DoubleSide });
        const leftPage = new THREE.Mesh(pageGeo, leftPageMat);
        leftPage.position.set(-1.5, 0, 0);
        leftPage.rotation.y = Math.PI / 8;
        bookGroup.add(leftPage);

        const rightPage = new THREE.Mesh(pageGeo, new THREE.MeshBasicMaterial({ color: 0xeaf6ff, side: THREE.DoubleSide }));
        rightPage.position.set(1.5, 0, 0);
        rightPage.rotation.y = -Math.PI / 8;
        bookGroup.add(rightPage);

        // Routes
        const pointsRoute1 = [new THREE.Vector3(0.5, -1.5, 0.2), new THREE.Vector3(1.5, 0, 0.5), new THREE.Vector3(2.5, 1.5, 0.2)];
        const pointsRoute2 = [new THREE.Vector3(2.5, 1.5, 0.2), new THREE.Vector3(1.0, 1.0, 0.6), new THREE.Vector3(0.5, -1.0, 0.2)];
        
        let curve = new THREE.CatmullRomCurve3(pointsRoute1);
        const routeLine = new THREE.Line(
            new THREE.BufferGeometry().setFromPoints(curve.getPoints(50)), 
            new THREE.LineBasicMaterial({ color: 0xff0000, linewidth: 3 })
        );
        bookGroup.add(routeLine);

        const car = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.2, 0.2), new THREE.MeshBasicMaterial({ color: 0x222222 }));
        bookGroup.add(car);

        // --- LOGIC & ANIMATIONS ---
        let isBookScene = false;
        let fraction = 0;

        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('startBtn').style.display = 'none';
            videoEl.play();

            // Wait 4 seconds for her to watch the video, then ZOOM!
            setTimeout(() => {
                gsap.to(camera.position, {
                    x: -3.5, y: -2.1, z: -4.5, // Fly exactly into the TV coordinates
                    duration: 2, ease: "power2.inOut",
                    onComplete: () => {
                        roomGroup.visible = false;
                        bookGroup.visible = true;
                        
                        camera.position.set(0, 0, 6); // Pull back for the book
                        isBookScene = true;
                        document.getElementById('nextBtn').style.display = 'block';
                    }
                });
            }, 4000);
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            // Swap photo for the 2nd video!
            const vid2 = document.getElementById('parkVideo2');
            const tex2 = new THREE.VideoTexture(vid2);
            leftPage.material.map = tex2;
            leftPage.material.needsUpdate = true;
            vid2.play();

            // Change route to FNB Park
            curve = new THREE.CatmullRomCurve3(pointsRoute2);
            routeLine.geometry.setFromPoints(curve.getPoints(50));
            fraction = 0;
            
            // Hide button after click
            document.getElementById('nextBtn').style.display = 'none'; 
        });

        function animate() {
            requestAnimationFrame(animate);
            if (isBookScene) {
                bookGroup.rotation.y = Math.sin(Date.now() * 0.0005) * 0.05;
                fraction += 0.003;
                if (fraction > 1) fraction = 0;
                car.position.copy(curve.getPoint(fraction));
            }
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
